
<!doctype html>
<html>
<head>
  <link type= "text/css" rel= "stylesheet" href="styles/style.css" />


  <title>Socket.IO chat</title>

</head>
<script src="scripts/script.js" type="text/JavaScript"></script>


<body> <!--onload="getName()"-->
<header>
  <h2>Adventure Chat</h2>
</header>

<div id = container>
  <div id="users">
    <p> Users</p>
    <ul id="user"> </ul>
  </div>

  <div id="rooms">
    <p> Rooms</p>
    <input type='button' value="create a new room"/>

    <ul class = 'room'>
      <!--<li><a href="/room1.html">Find a Partner</a></li>
      <li> <a href="/room2.html">Find Equipment</a></li>
      <li><a href="/room3.html">Find a Ride</a></li> -->
      <li><input type="button" id= "newPartner" class= 'roomButton' value="Find a Partner" /></li>
      <li><input type="button" id="equipment" class= 'roomButton' value="Find Equipment" /> </li>
      <li><input type="button" id="carShare" class= 'roomButton' value = "Find a Ride" /></li>
    </ul>
  </div>

<div id="messageBox">
  <section>
    <ul id="messages"></ul>
  </section>
  <section id="form">
    <form action="">
      <input id="m" autocomplete="off" placeholder="Talk to me..." /><button>Send</button>
    </form>
  </section>
  </div>
</div>

<script src="scripts/script.js" type="text/JavaScript"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>

<script>
  var socket = io();

  var name = "";

  var room = io.connect('/room');
  $('.roomButton').click(function(){
    var roomName = $(this).val(); //create a selector on the value name in the input so onclick we
    socket.emit('switchRoom', roomName);
  }); // this means we check the current selected element (so this case we are getting the value which was defined in the input tag)

  socket.on('connect', function(){// listen for when someone is connected to the server the users nickname
    name = prompt('What is your name?');
    socket.emit('join', name); //notifies the server of new user
  });

  $('form').submit(function(){
    var date = new Date(); // this is a construction
    console.log("date is " + date); // tells me what i'm looking at
    if(date.getMinutes() < 10){ // because if the time was 1:02 it would return 1:2 I created an if/else to add in proper display!
      date = date.getHours() + ":0" + date.getMinutes();
    }else{
      date = date.getHours() + ":" + date.getMinutes();
    };
    socket.emit('chat message', name+ " " + date + ": " + $('#m').val());
    var msg = $('#m').val();
    $('#m').val(''); // this is to clear the msg bar
    return false;
  });
  socket.on('chat message', function(msg) {
    $('#messages').append($('<li>').text(msg));//['name']+ " (" + msg["date"] + "): " + msg['msg']));// submits msgs into the box and puts them below previous statements.
    $('#messages').animate({
      scrollTop: $('#messages').height()
    }, "slow"); // need to find out how to scroll bottom (hint: its not scrollBottom)
    console.log(msg);
  });
  socket.on('username', function(username){
    $('#user').html(" "); //this clears the html in the user element and reloads :)
    for(i = username.length; i > -1; i--) {
      $('#user').append($('<div>').text(username[i]));
      //socket.emit('username', username[i]);
    };
  });
  socket.on('history', function(msgs){
    $('#messages').html(" ");
    if (msgs === null){
      return false;
    };
    for(i = msgs.length; i > -1; i--) {
      $('#messages').append($('<li>').text(msgs[i]));
    };
  });
</script>

</body>
</html>